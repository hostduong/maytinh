{{ define "dang_ky" }}
    {{ template "header" . }}

    <div class="flex items-center justify-center min-h-[calc(100vh-200px)] py-12 px-4 sm:px-6 lg:px-8 bg-gray-50">
        
        <div class="w-full max-w-md space-y-6 bg-white p-8 rounded-2xl shadow-lg border border-gray-100">
            
            <div class="text-center">
                <h2 class="text-3xl font-bold text-green-600">T·∫°o T√†i Kho·∫£n</h2>
                <p class="mt-2 text-sm text-gray-600">Tr·ªü th√†nh th√†nh vi√™n c·ªßa MayTinhShop</p>
            </div>

            {{ if .Loi }}
            <div class="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded text-sm flex items-center shadow-sm">
                <span class="mr-2 text-lg">‚ö†Ô∏è</span> {{ .Loi }}
            </div>
            {{ end }}

            <form id="formDangKy" class="mt-8 space-y-4" action="/register" method="POST" novalidate>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">H·ªç v√† t√™n</label>
                    <input id="ho_ten" name="ho_ten" type="text" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition"
                        placeholder="Nguy·ªÖn VƒÉn A">
                    <p id="err_ho_ten" class="text-red-500 text-xs mt-1 hidden">H·ªç t√™n t·ª´ 6-50 k√Ω t·ª±, kh√¥ng s·ªë, kh√¥ng k√Ω t·ª± ƒë·∫∑c bi·ªát.</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input id="email" name="email" type="email" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition"
                        placeholder="abc@gmail.com">
                    <p id="err_email" class="text-red-500 text-xs mt-1 hidden">Email kh√¥ng h·ª£p l·ªá ho·∫∑c ch·ª©a k√Ω t·ª± l·∫°.</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">M√£ PIN (8 s·ªë)</label>
                    <div class="relative">
                        <input id="ma_pin" name="ma_pin" type="text" maxlength="8"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition"
                            placeholder="12345678">
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-400">üî¢</div>
                    </div>
                    <p id="err_ma_pin" class="text-red-500 text-xs mt-1 hidden">PIN ph·∫£i ƒë√∫ng 8 ch·ªØ s·ªë.</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">T√™n ƒëƒÉng nh·∫≠p</label>
                    <input id="ten_dang_nhap" name="ten_dang_nhap" type="text" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition"
                        placeholder="user123">
                    <p id="err_ten_dang_nhap" class="text-red-500 text-xs mt-1 hidden">T√™n ƒëƒÉng nh·∫≠p 6-30 k√Ω t·ª± (ch·ªØ, s·ªë, . _), kh√¥ng d·∫•u c√°ch.</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">M·∫≠t kh·∫©u</label>
                    <div class="relative">
                        <input id="mat_khau" name="mat_khau" type="password" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition"
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        <button type="button" onclick="togglePass('mat_khau')" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none">üëÅÔ∏è</button>
                    </div>
                    <p id="err_mat_khau" class="text-red-500 text-xs mt-1 hidden">M·∫≠t kh·∫©u 8-30 k√Ω t·ª±, kh√¥ng ch·ª©a d·∫•u c√°ch, ' " < >.</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nh·∫≠p l·∫°i m·∫≠t kh·∫©u</label>
                    <div class="relative">
                        <input id="re_mat_khau" type="password" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition"
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                        <button type="button" onclick="togglePass('re_mat_khau')" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none">üëÅÔ∏è</button>
                    </div>
                    <p id="err_re_mat_khau" class="text-red-500 text-xs mt-1 hidden">M·∫≠t kh·∫©u nh·∫≠p l·∫°i kh√¥ng kh·ªõp!</p>
                </div>

                <div class="pt-2">
                    <button type="submit" id="btnSubmit"
                        class="group w-full flex justify-center py-3 px-4 border border-transparent text-sm font-bold rounded-lg text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 shadow-lg shadow-green-500/30 transition transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                        ƒêƒÇNG K√ù NGAY
                    </button>
                </div>

                <div class="text-center text-sm mt-4">
                    ƒê√£ c√≥ t√†i kho·∫£n? <a href="/login" class="font-medium text-blue-600 hover:text-blue-500">ƒêƒÉng nh·∫≠p</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        // === C·∫§U H√åNH REGEX (Gi·ªëng h·ªát Backend GO) ===
        const REGEX = {
            ho_ten: /^[\p{L}\s]{6,50}$/u,  // Ch·ªØ c√°i Unicode, kho·∫£ng tr·∫Øng, 6-50 k√Ω t·ª±
            email: /^[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,100}$/,
            ma_pin: /^\d{8}$/,             // ƒê√∫ng 8 s·ªë
            ten_dang_nhap: /^[a-z0-9._]{6,30}$/i, // a-z, 0-9, . _, 6-30 chars
            mat_khau: /^[^'"<>\s]{8,30}$/  // Kh√¥ng ch·ª©a k√Ω t·ª± c·∫•m, 8-30 chars
        };

        // H√†m hi·ªÉn th·ªã l·ªói
        function showErr(id, isError) {
            const input = document.getElementById(id);
            const msg = document.getElementById('err_' + id);
            
            if (isError) {
                // Style l·ªói: Vi·ªÅn ƒë·ªè
                input.classList.remove('border-gray-300', 'border-green-500', 'focus:ring-green-500');
                input.classList.add('border-red-500', 'focus:ring-red-500');
                msg.classList.remove('hidden');
            } else {
                // Style ƒë√∫ng: Vi·ªÅn xanh
                input.classList.remove('border-gray-300', 'border-red-500', 'focus:ring-red-500');
                input.classList.add('border-green-500', 'focus:ring-green-500');
                msg.classList.add('hidden');
            }
            checkFormValid();
        }

        // Ki·ªÉm tra to√†n b·ªô form ƒë·ªÉ B·∫≠t/T·∫Øt n√∫t Submit
        function checkFormValid() {
            const inputs = ['ho_ten', 'email', 'ma_pin', 'ten_dang_nhap', 'mat_khau', 're_mat_khau'];
            let isValid = true;
            
            inputs.forEach(id => {
                const el = document.getElementById(id);
                if (el.classList.contains('border-red-500') || el.value === '') {
                    isValid = false;
                }
            });

            const btn = document.getElementById('btnSubmit');
            if (isValid) {
                btn.disabled = false;
                btn.classList.remove('cursor-not-allowed', 'opacity-50');
            } else {
                btn.disabled = true;
                btn.classList.add('cursor-not-allowed', 'opacity-50');
            }
        }

        // --- G·∫ÆN S·ª∞ KI·ªÜN NH·∫¨P LI·ªÜU (REAL-TIME) ---

        document.getElementById('ho_ten').addEventListener('input', function() {
            // Lo·∫°i b·ªè s·ªë n·∫øu ng∆∞·ªùi d√πng c·ªë nh·∫≠p
            this.value = this.value.replace(/[0-9]/g, ''); 
            showErr('ho_ten', !REGEX.ho_ten.test(this.value.trim()));
        });

        document.getElementById('email').addEventListener('input', function() {
            showErr('email', !REGEX.email.test(this.value.trim()));
        });

        document.getElementById('ma_pin').addEventListener('input', function() {
            this.value = this.value.replace(/[^0-9]/g, ''); // Ch·ªâ cho nh·∫≠p s·ªë
            showErr('ma_pin', !REGEX.ma_pin.test(this.value));
        });

        document.getElementById('ten_dang_nhap').addEventListener('input', function() {
            this.value = this.value.replace(/[^a-zA-Z0-9._]/g, ''); // Ch·∫∑n k√Ω t·ª± l·∫° ngay khi g√µ
            showErr('ten_dang_nhap', !REGEX.ten_dang_nhap.test(this.value));
        });

        document.getElementById('mat_khau').addEventListener('input', function() {
            showErr('mat_khau', !REGEX.mat_khau.test(this.value));
            // Ki·ªÉm tra l·∫°i √¥ nh·∫≠p l·∫°i pass n·∫øu ƒëang c√≥ d·ªØ li·ªáu
            const rePass = document.getElementById('re_mat_khau');
            if(rePass.value !== '') {
                showErr('re_mat_khau', this.value !== rePass.value);
            }
        });

        document.getElementById('re_mat_khau').addEventListener('input', function() {
            const pass = document.getElementById('mat_khau').value;
            showErr('re_mat_khau', this.value !== pass);
        });

        // H√†m hi·ªán ·∫©n m·∫≠t kh·∫©u
        function togglePass(id) {
            const el = document.getElementById(id);
            el.type = el.type === 'password' ? 'text' : 'password';
        }
        
        // Ch·∫∑n submit n·∫øu form ch∆∞a valid (ph√≤ng tr∆∞·ªùng h·ª£p enter)
        document.getElementById('formDangKy').addEventListener('submit', function(e) {
            const btn = document.getElementById('btnSubmit');
            if(btn.disabled) {
                e.preventDefault();
                alert("Vui l√≤ng ki·ªÉm tra l·∫°i c√°c tr∆∞·ªùng th√¥ng tin b√°o ƒë·ªè!");
            }
        });

    </script>

    {{ template "footer" . }}
{{ end }}
