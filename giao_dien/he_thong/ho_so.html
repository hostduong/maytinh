{{ define "ho_so" }}
    {{ template "header" . }}

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <div class="max-w-2xl mx-auto py-10">
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
            
            <div class="bg-blue-500 h-32 relative"></div>
            <div class="text-center -mt-16 relative">
                <div class="inline-block p-1 bg-white rounded-full shadow-md">
                    <div class="w-24 h-24 bg-gray-800 rounded-full flex items-center justify-center text-white text-4xl overflow-hidden">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed={{ .NhanVien.TenDangNhap }}" alt="Avatar" class="w-full h-full">
                    </div>
                </div>
                <h2 class="mt-3 text-2xl font-bold text-gray-800" id="lblHoTen">
                    {{ .NhanVien.HoTen }}
                </h2>
                <p class="text-blue-500 font-medium">{{ .NhanVien.ChucVu }}</p>
            </div>

            <div class="p-8 space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-xs text-gray-400 uppercase font-bold tracking-wider">M√£ th√†nh vi√™n</label>
                        <div class="mt-1 p-3 bg-gray-50 rounded border border-gray-100 font-mono text-gray-700 font-semibold">
                            {{ .NhanVien.MaNhanVien }}
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-400 uppercase font-bold tracking-wider">T√™n ƒëƒÉng nh·∫≠p</label>
                        <div class="mt-1 p-3 bg-gray-50 rounded border border-gray-100 text-gray-800">
                            {{ .NhanVien.TenDangNhap }}
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-xs text-gray-400 uppercase font-bold tracking-wider">Email</label>
                    <div class="mt-1 text-lg text-gray-800 border-b border-gray-200 pb-1">
                        {{ if .NhanVien.Email }}{{ .NhanVien.Email }}{{ else }}<span class="text-gray-400 italic">Ch∆∞a c·∫≠p nh·∫≠t</span>{{ end }}
                    </div>
                </div>
                <div>
                    <label class="block text-xs text-gray-400 uppercase font-bold tracking-wider">Ng√†y tham gia</label>
                    <div class="mt-1 text-gray-600 text-sm">
                         {{ .NhanVien.LanDangNhapCuoi }}
                    </div>
                </div>
            </div>

            <div class="bg-gray-50 px-8 py-6 border-t border-gray-100 flex flex-wrap justify-center gap-3">
                <button onclick="toggleModal('modalPass')" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg font-medium shadow-lg shadow-blue-500/30 transition transform hover:-translate-y-0.5">
                    ƒê·ªïi m·∫≠t kh·∫©u
                </button>
                <button onclick="toggleModal('modalInfo')" class="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 px-5 py-2.5 rounded-lg font-medium transition shadow-sm">
                    C·∫≠p nh·∫≠t th√¥ng tin
                </button>
                <button onclick="toggleModal('modalPin')" class="bg-purple-50 text-purple-600 hover:bg-purple-100 border border-purple-200 px-5 py-2.5 rounded-lg font-medium transition">
                    ƒê·ªïi m√£ PIN
                </button>
            </div>
        </div>
    </div>

    <div id="modalPass" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm transition-opacity">
        <div class="bg-white p-6 rounded-2xl shadow-2xl w-96 transform transition-all scale-100">
            <h3 class="text-xl font-bold mb-4 text-gray-800">üîê ƒê·ªïi M·∫≠t Kh·∫©u</h3>
            <div class="space-y-3">
                <input type="password" id="oldPass" placeholder="M·∫≠t kh·∫©u hi·ªán t·∫°i" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                <input type="password" id="newPass" placeholder="M·∫≠t kh·∫©u m·ªõi" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div class="mt-6 flex justify-end gap-3">
                <button onclick="toggleModal('modalPass')" class="text-gray-500 hover:bg-gray-100 px-4 py-2 rounded-lg font-medium">H·ªßy</button>
                <button onclick="doiPass()" class="bg-blue-600 text-white px-5 py-2 rounded-lg font-bold hover:bg-blue-700 shadow-md">L∆∞u thay ƒë·ªïi</button>
            </div>
        </div>
    </div>

    <div id="modalInfo" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-white p-6 rounded-2xl shadow-2xl w-96">
            <h3 class="text-xl font-bold mb-4 text-gray-800">‚úèÔ∏è C·∫≠p nh·∫≠t th√¥ng tin</h3>
            <div class="space-y-3">
                <label class="text-sm text-gray-500">H·ªç v√† t√™n hi·ªÉn th·ªã</label>
                <input type="text" id="newName" value="{{ .NhanVien.HoTen }}" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div class="mt-6 flex justify-end gap-3">
                <button onclick="toggleModal('modalInfo')" class="text-gray-500 hover:bg-gray-100 px-4 py-2 rounded-lg font-medium">H·ªßy</button>
                <button onclick="doiTen()" class="bg-blue-600 text-white px-5 py-2 rounded-lg font-bold hover:bg-blue-700 shadow-md">C·∫≠p nh·∫≠t</button>
            </div>
        </div>
    </div>

    <div id="modalPin" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-white p-6 rounded-2xl shadow-2xl w-96">
            <h3 class="text-xl font-bold mb-4 text-gray-800">üî¢ ƒê·ªïi M√£ PIN B·∫£o M·∫≠t</h3>
            <p class="text-xs text-gray-500 mb-3">M√£ PIN d√πng ƒë·ªÉ kh√¥i ph·ª•c m·∫≠t kh·∫©u khi qu√™n.</p>
            <div class="space-y-3">
                <input type="text" id="oldPin" maxlength="6" placeholder="M√£ PIN c≈©" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none">
                <input type="text" id="newPin" maxlength="6" placeholder="M√£ PIN m·ªõi (6 s·ªë)" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none">
            </div>
            <div class="mt-6 flex justify-end gap-3">
                <button onclick="toggleModal('modalPin')" class="text-gray-500 hover:bg-gray-100 px-4 py-2 rounded-lg font-medium">H·ªßy</button>
                <button onclick="doiPin()" class="bg-purple-600 text-white px-5 py-2 rounded-lg font-bold hover:bg-purple-700 shadow-md">L∆∞u PIN</button>
            </div>
        </div>
    </div>

    <script>
        function toggleModal(id) {
            const modal = document.getElementById(id);
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => modal.firstElementChild.classList.add('scale-100'), 10);
            } else {
                modal.classList.add('hidden');
            }
        }

        async function postData(url, data) {
            const formData = new FormData();
            for(const k in data) formData.append(k, data[k]);
            try {
                const res = await fetch(url, { method: 'POST', body: formData });
                return await res.json();
            } catch (e) {
                return { status: 'error', msg: 'L·ªói k·∫øt n·ªëi server!' };
            }
        }

        // --- ƒê·ªîI M·∫¨T KH·∫®U ---
        async function doiPass() {
            const res = await postData('/api/user/change-pass', {
                pass_cu: document.getElementById('oldPass').value,
                pass_moi: document.getElementById('newPass').value
            });
            
            if(res.status === 'ok') {
                Swal.fire({ icon: 'success', title: 'Th√†nh c√¥ng!', text: res.msg, timer: 2000, showConfirmButton: false });
                document.getElementById('oldPass').value = '';
                document.getElementById('newPass').value = '';
                toggleModal('modalPass');
            } else {
                Swal.fire({ icon: 'error', title: 'L·ªói!', text: res.msg });
            }
        }

        // --- ƒê·ªîI T√äN ---
        async function doiTen() {
            const newName = document.getElementById('newName').value;
            const res = await postData('/api/user/update-info', { ho_ten_moi: newName });
            
            if(res.status === 'ok') {
                Swal.fire({ icon: 'success', title: 'C·∫≠p nh·∫≠t xong!', text: res.msg, timer: 1500, showConfirmButton: false });
                document.getElementById('lblHoTen').innerText = newName;
                toggleModal('modalInfo');
            } else {
                Swal.fire({ icon: 'error', title: 'L·ªói!', text: res.msg });
            }
        }

        // --- ƒê·ªîI PIN ---
        async function doiPin() {
            const res = await postData('/api/user/change-pin', {
                pin_cu: document.getElementById('oldPin').value,
                pin_moi: document.getElementById('newPin').value
            });
            
            if(res.status === 'ok') {
                Swal.fire({ icon: 'success', title: 'Th√†nh c√¥ng!', text: res.msg, timer: 2000, showConfirmButton: false });
                document.getElementById('oldPin').value = '';
                document.getElementById('newPin').value = '';
                toggleModal('modalPin');
            } else {
                Swal.fire({ icon: 'error', title: 'L·ªói!', text: res.msg });
            }
        }
    </script>

    {{ template "footer" . }}
{{ end }}
